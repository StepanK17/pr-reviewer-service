# PR Reviewer Service

Тестовое задание для стажёра Backend (осенняя волна 2025)

Микросервис для автоматического назначения ревьюеров на Pull Request'ы.

## Быстрый старт

```bash
# 1. Клонируйте репозиторий
git clone https://github.com/StepanK17/pr-reviewer-service.git
cd pr-reviewer-service

# 2. Запустите сервис
docker-compose up --build
```

Сервис будет доступен на http://localhost:8080

**Проверка работоспособности:**
```bash
curl http://localhost:8080/health
```

## Основные возможности

- Автоназначение до 2 ревьюеров на PR из команды автора
- Переназначение ревьюверов из команды заменяемого ревьювера
- Идемпотентный merge с блокировкой изменений после слияния
- Управление командами и активностью пользователей
- Статистика по назначениям
- Массовая деактивация команды

## Технологии

- **Язык:** Go 1.24.4
- **База данных:** PostgreSQL 15
- **Фреймворк:** chi router
- **Контейнеризация:** Docker + Docker Compose

## API Endpoints

### Основные эндпоинты

**Команды:**
- `POST /team/add` - создать команду с участниками
- `GET /team/get?team_name=name` - получить информацию о команде
- `POST /team/deactivateMembers` - массовая деактивация команды (требует admin token)

**Пользователи:**
- `POST /users/setIsActive` - изменить активность пользователя
- `GET /users/getReview?user_id=id` - получить PR пользователя

**Pull Requests:**
- `POST /pullRequest/create` - создать PR (автоназначение ревьюверов)
- `POST /pullRequest/merge` - merge PR (идемпотентно)
- `POST /pullRequest/reassign` - переназначить ревьювера

**Дополнительные:**
- `GET /statistics` - статистика системы
- `GET /health` - проверка здоровья сервиса

## Команды разработки

```bash
make help          # Показать все команды
make build         # Собрать приложение
make docker-up     # Запустить в Docker
make docker-down   # Остановить Docker
make docker-clean  # Остановить и удалить volumes
make e2e-test      # Запустить E2E тесты
make migrate-up    # Применить миграции
make migrate-down  # Откатить миграции
make clean         # Очистить build артефакты
make deps          # Установить зависимости
```

## Результаты нагрузочного тестирования

## Требования 

- **RPS:** ≥ 5
- **SLI времени ответа:** < 300 мс
- **SLI успешности:** ≥ 99.9%
- **Объём данных:** до 20 команд, до 200 пользователей

## Результаты

### 1. GET /health
- **RPS:** 2216.66
- **Среднее время:** 4.511 ms
- **P95:** 7 ms
- **P99:** 60 ms
- **Ошибки:** 0

### 2. GET /team/get
- **RPS:** 1588.25
- **Среднее время:** 6.296 ms
- **P95:** 12 ms
- **P99:** 54 ms
- **Ошибки:** 0

### 3. GET /users/getReview
- **RPS:** 2211.48
- **Среднее время:** 4.522 ms
- **P95:** 8 ms
- **P99:** 15 ms
- **Ошибки:** 0

### 4. GET /statistics
- **RPS:** 770.76
- **Среднее время:** 12.974 ms
- **P95:** 27 ms
- **P99:** 43 ms
- **Ошибки:** 0

### 5. POST /pullRequest/create
- **Всего запросов:** 100
- **Успешных:** 100
- **Среднее время:** 58 ms
- **Мин. время:** 52 ms
- **Макс. время:** 87 ms
- **Успешность:** 100,00%

### 6. POST /team/deactivateMembers (Дополнительное задание)
- **Деактивировано пользователей:** 0
- **Переназначено PR:** 0
- **Время выполнения:** 64 ms
- **Требование:** < 100 ms

## Выводы

1. Все эндпоинты превышают требования по RPS
2. Время ответа значительно ниже 300 мс для всех эндпоинтов
3. Успешность > 99.9%


### E2E тестирование
Все тесты проходят успешно: создание команд, автоназначение ревьюверов, переназначение, merge операции, обработка ошибок, 
массовая деактивация команд, статистика системы. 

---

**Автор:** Степан Коротеев  
**GitHub:** @StepanK17  
